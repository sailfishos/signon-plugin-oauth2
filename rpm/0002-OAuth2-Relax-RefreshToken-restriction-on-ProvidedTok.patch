From 050ff74f89a1733e56cbce360058b984dd1fdd95 Mon Sep 17 00:00:00 2001
From: Chris Adams <chris.adams@jollamobile.com>
Date: Thu, 27 Mar 2014 18:58:03 +1000
Subject: [PATCH 2/6] OAuth2: Relax RefreshToken restriction on ProvidedTokens

Some OAuth2 services (like Facebook) do not return RefreshToken
data, only AccessToken and ExpiresIn.  This commit ensures that
clients can still provide cached token data when no RefreshToken
is present in the token map.
---
 src/oauth2plugin.cpp | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/src/oauth2plugin.cpp b/src/oauth2plugin.cpp
index 77aa862..290adf0 100644
--- a/src/oauth2plugin.cpp
+++ b/src/oauth2plugin.cpp
@@ -282,9 +282,8 @@ void OAuth2Plugin::process(const SignOn::SessionData &inData,
         OAuth2PluginTokenData providedTokens =
                 SignOn::SessionData(tokens.ProvidedTokens())
                 .data<OAuth2PluginTokenData>();
-        if (providedTokens.AccessToken().isEmpty() ||
-            providedTokens.RefreshToken().isEmpty()) {
-            //note: we don't check ExpiresIn as it might not be required
+        if (providedTokens.AccessToken().isEmpty()) {
+            //note: we don't check RefreshToken or ExpiresIn as it might not be required
             TRACE() << "Invalid provided tokens data - continuing normal process flow";
         } else {
             TRACE() << "Storing provided tokens";
-- 
2.17.1

